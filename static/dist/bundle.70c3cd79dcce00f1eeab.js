"use strict";(self.webpackChunkdepot=self.webpackChunkdepot||[]).push([[741],{9741:function(e,t,s){s.r(t),s.d(t,{default:function(){return o}});var a=s(6540),r=s(1083),l=s(6065),n=s(5580),c=s(6546),m=({onClose:e})=>{const[t,s]=(0,a.useState)(""),[l,n]=(0,a.useState)(!1),[m,o]=(0,a.useState)(!1),u=async e=>{e.preventDefault(),r.A.post("/api/request/create",{text:t}).then((e=>n(!0))).catch((e=>o(!0))),setTimeout((()=>{n(!1),o(!1)}),5e3)};return a.createElement("div",{className:"editor__popup"},a.createElement("div",{className:"editor__popup--content"},a.createElement("div",{className:"editor__popup--header flex flex--sb flex--center"},a.createElement("h2",{className:"editor__title"},"Создать новое обращение"),a.createElement("button",{className:"editor__close",onClick:e,"aria-label":"Закрыть"},a.createElement(c.A,{selector:"CloseIcon",width:"30",height:"30"}))),a.createElement("form",{className:"form form--admin",onSubmit:u},a.createElement("div",{className:"form__group"},a.createElement("textarea",{className:"form__input form__input--black",name:"text",id:"ticketText",rows:"5",placeholder:"Введите текст обращения",onChange:e=>s(e.target.value)})),a.createElement("button",{className:"button animate--pulse",onClick:u},"Отправить"),l&&a.createElement("div",{className:"editor__message editor__message--green"},"Запрос отправлен"),m&&a.createElement("div",{className:"editor__message editor__message--red"},"Ошибка отправки запроса"))))},o=()=>{const[e,t]=(0,a.useState)({}),[s,c]=(0,a.useState)(""),[o,u]=(0,a.useState)(null),[i,_]=(0,a.useState)(!1),[d,g]=(0,a.useState)(null),[E,p]=(0,a.useState)(null),[v,f]=(0,a.useState)(!1),N={closed:"Закрыто",new:"Ожидание",in_process:"Активно"};(0,a.useEffect)((()=>{r.A.get("/api/requests").then((e=>{const s=e.data.reduce(((e,t)=>{const s=t.ticket_number;return e[s]||(e[s]=[]),e[s].push(t),e[s].sort(((e,t)=>new Date(e.date)-new Date(t.date))),e}),{});t(s)})).catch((e=>{console.error("Error fetching requests:",e)})),h()}),[]);const h=()=>{r.A.get("/api/tenant/tg").then((e=>{c(e.data.username),console.log(e.data.username,e.data.tg_id),e.data.username&&0!==e.data.tg_id&&_(!0)})).catch((e=>console.error("Error fetching telegram username:",e)))};return a.createElement("div",{className:"requests"},a.createElement("h2",{className:"requests__title"},"Ваши обращения"),a.createElement("div",{className:"requests__summary"},"Создать обращение можно с помощью Telegram-бота, для этого задайте ваше имя пользователя Telegram и перейдите в бота. Для запуска бота введите команду /start."),a.createElement("form",{className:"form form--small",onSubmit:e=>{e.preventDefault();let t=s.trim();return t.startsWith("@")?t=t.slice(1):t.startsWith("t.me/")&&(t=t.slice(5)),t?/^[a-zA-Z0-9_]{5,32}$/.test(t)?void r.A.post("/api/tenant/tg",{tg_user:t}).then((e=>{c(t),h(),p("Имя пользователя успешно обновлено!"),setTimeout((()=>{p("")}),5e3)})).catch((e=>{g("Ошибка обновления."),setTimeout((()=>{g("")}),5e3),console.error("Error updating telegram username:",e)})):(g("Некорректное имя пользователя. Имя должно содержать от 5 до 32 символов и может содержать буквы, цифры и символы подчеркивания."),void setTimeout((()=>{g("")}),5e3)):(g("Имя пользователя не может быть пустым."),void setTimeout((()=>{g("")}),5e3))}},a.createElement("input",{type:"text",name:"telegramUsername",placeholder:"Имя пользователя Telegram",value:s,onChange:e=>c(e.target.value),className:"form__input"}),a.createElement("button",{type:"submit",className:"form__button button"},"Сохранить"),d&&a.createElement("div",{className:"form__message form__message--red"},d),E&&a.createElement("div",{className:"form__message form__message--green"},E)),i&&a.createElement("div",{className:"requests__form"},a.createElement("button",{className:"button animate--pulse",onClick:()=>f(!0)},"Создать новое обращение")),a.createElement("div",{className:"requests__line"},a.createElement("div",{className:"requests__title"},"История обращений"),a.createElement("div",{className:"requests__title"},"Статус")),a.createElement("div",{className:"requests__list"},Object.keys(e).map((t=>{const s=e[t][0];return a.createElement("div",{className:"requests__line",key:t,onClick:()=>(t=>{u(e[t])})(t)},a.createElement("div",{className:"requests__info"},"Обращение от ",(0,l.GP)(new Date(s.date),"d MMMM yyyy",{locale:n.ru})," года"),a.createElement("div",{className:`requests__status requests__status--${s.status}`},N[s.status]))}))),o&&a.createElement("div",{className:"requests__dialogue"},o.map(((e,t)=>a.createElement("div",{key:t,className:"requests__message "+(e.manager?"requests__message--manager":"")},a.createElement("div",{className:"requests__meta"},a.createElement("div",{className:"requests__from"},e.manager?"Ответ менеджера:":"Вы:"),a.createElement("div",{className:"requests__time"},(0,l.GP)(new Date(e.date),"d MMMM yyyy, HH:mm",{locale:n.ru}))),a.createElement("div",{className:"requests__text"},e.text))))),a.createElement("div",{className:"requests__desc requests__desc--new"},"Ваше обращение находится в очереди на рассмотрение"),a.createElement("div",{className:"requests__desc requests__desc--in_process"},"По вашему обращению есть ответ от менеджера, пожалуйста, проверьте свой телеграм."),a.createElement("div",{className:"requests__desc requests__desc--closed"},"По вашему обращению было принято решение"),v&&a.createElement(m,{onClose:()=>f(!1)}))}},6546:function(e,t,s){var a=s(6540);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},r.apply(null,arguments)}t.A=({selector:e="",width:t=12,height:s=12,fill:l="none",classNames:n="",...c})=>a.createElement("svg",r({className:`icon icon-${e} ${n}`,fill:l,width:t,height:s},c),a.createElement("use",{xlinkHref:`#${e}`}))}}]);